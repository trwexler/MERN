
Hoisting
Introduction

When we send JavaScript to the browser to run, the interpreter breaks that down into two steps. First, it parses the code, and ensures it's all viable JavaScript friendly syntax. Second, it runs the code. You might think your code is running line by line, but with JavaScript, this isn't always the case. It is common for even experienced Devs to not completely understand the hoisting rules, but it is important for writing clean JS.
Variable Hoisting with var

What happens when we use a variable we haven't created?

console.log(magicalUnicorns);

We get ReferenceError: magicalUnicorns is not defined. This is an example of a parsing error: Our code never ran, it stopped right there as soon as the parser noticed we were trying to use an uninitialized variable. Let's see how the var keyword affects this:

console.log(magicalUnicorns);
var magicalUnicorns = "awesome";

If you ran the above code, you might have noticed something odd. There was no ReferenceError. Instead our console.log output undefined. Something else must be going on here. What's really happening is our var variable is being hoisted.

In JavaScript, variable declarations are hoisted to the top of their scope. Here's how the interpreter actually reads the previous example:

var magicalUnicorns; // the declaration gets hoisted to the top of the scope by itself
console.log(magicalUnicorns); // we log it as undefined
magicalUnicorns = "awesome"; // the assignment stays exactly where it was

On the flip side, let and const do not allow us to do this.

console.log(magicalUnicorns); 
let magicalUnicorns = "awesome!";

In the above example, let will produce ReferenceErrors if we try to call the variable this way.
Hoisting in Functions

We discuss earlier that function calls create their own scope. How do you think the next snippet will run?

var foo = "bar";
function magic(){
    foo = "hello world";
    console.log(foo);
    var foo;
}
magic();
console.log(foo);

When you run this code, what are your console logs and in what order? The answer might be a surprise. Let's break it down.

function magic(){         // 'magic()' gets hoisted to the top
    var foo;              // here 'foo' is declared within 'magic()' and gets hoisted to the top of its scope
    foo = "hello world";  // we assign a value to our function scoped 'foo'
    console.log(foo);     // we log it as 'hello world'
}                       
var foo;                  // 'foo' is a declaration, it's global and gets hoisted to just under the hoisted functions
foo = "bar";              // here, we assign a value to the global 'foo'
magic();                  // magic is called, the first console.log runs
console.log(foo);         // finally we log the global foo

There are two takeaways here: Functions act like a cage, preventing declarations from being hoisted out of them. Another thing to remember is that standalone functions get hoisted before variables. Let's see if you can predict the output of this next example without running it:

magicalUnicorns();
var magicalUnicorns = function(){
    console.log("Will it blend?");
}
console.log("Don't breathe this!");

Which console log fires first? Neither! We get the error 'magicalUnicorns is not a function'. Why? The variable magicalUnicorns got hoisted to the top, and we tried to invoke it before we assigned the function to it.

The above code will be interpreted as:

var magicalUnicorns;
magicalUnicorns();
magicalUnicorns = function(){
    console.log("Will it blend?");
}
console.log("Don't breathe this!");

Key Rules of Hoisting

• Functions are hoisted before any variable declarations.

• Variable declarations (var) rise to the top of their scope like hot air balloons.

• Functions create their own scope and act like cages, preventing declarations from rising out.

• Assignments, or = signs, act like anchors. They stay put, no matter how the code is rearranged.

• let and const do not get hoisted,  and will throw an error if called before they are declared. const will even throw a syntax error if it is called before it is assigned.



1. console.log(hello);                                   
var hello = 'world';    

var hello; 
console.log(hello);  
hello='world'                                 
   

2


var needle = 'haystack';
test();
function test(){
    var needle = 'magnet';
    console.function call from-rainbow">log(needle);
}

test();
function test(){
    var needle = 'magnet';
    console.function call from-rainbow">log(needle);
}
var needle;
needle="haystack";

//this is a syntax error




3

var brendan = 'super cool';
function print(){
    brendan = 'only okay';
    console.log(brendan);
}
console.log(brendan);


console.log(brendan);
var brendan = 'super cool';
function print(){
    brendan = 'only okay';
    console.log(brendan);
}

//super cool




4

var food = 'chicken';
console.log(food);
eat();
function eat(){
    food = 'half-chicken';
    console.log(food);
    var food = 'gone';
}


console.log(food);
var food = 'chicken';
eat();
function eat(){
    food = 'half-chicken';
    console.log(food);
    var food = 'gone';
}

//chicken
//half-chicken




5

mean();
console.log(food);
var mean = function() {
    food = "chicken";
    console.log(food);
    var food = "fish";
    console.log(food);
}
console.log(food);


//mean is not a function





6

console.log(genre);
var genre = "disco";
rewind();
function rewind() {
    genre = "rock";
    console.log(genre);
    var genre = "r&b";
    console.log(genre);
}
console.log(genre);


console.log(genre);
var genre = "disco";
rewind();
function rewind() {
    genre = "rock";
    console.log(genre);
    var genre = "r&b";
    console.log(genre);
}
console.log(genre);

correctly written as is
//disco
//rock
//r&b
//disco




7

dojo = "san jose";
console.log(dojo);
learn();
function learn() {
    console.log(dojo);
    dojo = "seattle";
    console.log(dojo);
    var dojo = "burbank";
    console.log(dojo);
}
console.log(dojo);



console.log(dojo);
dojo = "san jose";
learn();
function learn() {
    console.log(dojo);
    dojo = "seattle";
    console.log(dojo);
    var dojo = "burbank";
    console.log(dojo);
}
console.log(dojo);

//san jose
//san jose
//seattle
//burbank
//san jose



8 - Bonus ES6: const

console.log(makeDojo("Chicago", 65));
console.log(makeDojo("Berkeley", 0));
function makeDojo(name, students){
    const dojo = {};
    dojo.name = name;
    dojo.students = students;
    if(dojo.students > 50){
        dojo.hiring = true;
    }
    else if(dojo.students <= 0){
        dojo = "closed for now";
    }
    return dojo;
}


console.log(makeDojo("Chicago", 65));
function makeDojo(name, students){
    const dojo = {};
    dojo.name = name;
    dojo.students = students;
    if(dojo.students > 50){
        dojo.hiring = true;
    }
    else if(dojo.students <= 0){
        dojo = "closed for now";
    }
    return dojo;
}
console.log(makeDojo("Berkeley", 0));
function makeDojo(name, students){
    const dojo = {};
    dojo.name = name;
    dojo.students = students;
    if(dojo.students > 50){
        dojo.hiring = true;
    }
    else if(dojo.students <= 0){
        dojo = "closed for now";
    }
    return dojo;
}

true
closed for now

//just true const can't change





ES5 ANSWERS:

// Functions are always hoisted first
// vars are hoisted immediately after (below) the functions
// https://262.ecma-international.org/5.1/#sec-10.5

// #1 - GIVEN
console.log(hello);
var hello = "world";
// var hello;
// console.log(hello);
// hello = "world";

// output:
//    undefined

// #2 - GIVEN
var needle = "haystack";
test();
function test() {
  var needle = "magnet";
  console.log(needle);
}
// function test() {
//   var needle = "magnet";
//   console.log(needle);
// }
// var needle;
// needle = "haystack";
// test();

// output:
//    magnet

// #3 - GIVEN
var brendan = "super cool";
function print() {
  brendan = "only okay";
  console.log(brendan);
}
print();
console.log(brendan);
// function print() {
//   brendan = "only okay";
//   console.log(brendan);
// }
// var brendan;
// brendan = "super cool";
// print();
// console.log(brendan);

// output:
//    only okay
//    only okay

// #4 - GIVEN
var food = "chicken";
console.log(food);
eat();
function eat() {
  food = "half-chicken";
  console.log(food);
  var food = "gone";
}
// function eat() {
//   var food;
//   food = "half-chicken";
//   console.log(food);
//   food = "gone";
// }
// var food;
// food = "chicken";
// console.log(food);
// eat();

// output:
//    chicken
//    half-chicken

// #5 - GIVEN
mean();
console.log(food);
var mean = function () {
  food = "chicken";
  console.log(food);
  var food = "fish";
  console.log(food);
};
console.log(food);
// var mean;                 // only var is hoisted
// mean();
// console.log(food);
// mean = function () {      // equals acts as an anchor
//   var food;
//   food = "chicken";
//   console.log(food);
//   food = "fish";
//   console.log(food);
// };
// console.log(food);

// output:
//    TypeError: mean is not a function

// #6 - GIVEN
console.log(genre);
var genre = "disco";
rewind();
function rewind() {
  genre = "rock";
  console.log(genre);
  var genre = "r&b";
  console.log(genre);
}
console.log(genre);
// function rewind() {
//   var genre;
//   genre = "rock";
//   console.log(genre);
//   genre = "r&b";
//   console.log(genre);
// }
// var genre;
// console.log(genre);
// genre = "disco";
// rewind();
// console.log(genre);

// output:
//    undefined
//    rock
//    r&b
//    disco

// #7 - GIVEN
dojo = "san jose";
console.log(dojo);
learn();
function learn() {
  console.log(dojo);
  dojo = "seattle";
  console.log(dojo);
  var dojo = "burbank";
  console.log(dojo);
}
console.log(dojo);
// function learn() {
//   var dojo
//   console.log(dojo);
//   dojo = "seattle";
//   console.log(dojo);
//   dojo = "burbank";
//   console.log(dojo);
// }
// dojo = "san jose";    // Javascript allows this even though it is NOT defined as a var in the global scope
// console.log(dojo);
// learn();
// console.log(dojo);

// output:
//    san jose
//    undefined          // local scoped variable is used
//    seattle
//    burbank
//    san jose

// #8 - GIVEN
console.log(makeDojo("Chicago", 65));
console.log(makeDojo("Berkeley", 0));
function makeDojo(name, students) {
  const dojo = {};
  dojo.name = name;
  dojo.students = students;
  if (dojo.students > 50) {
    dojo.hiring = true;
  } else if (dojo.students <= 0) {
    dojo = "closed for now";
  }
  return dojo;
}
// function makeDojo(name, students) {
//   const dojo = {};
//   dojo.name = name;
//   dojo.students = students;
//   if (dojo.students > 50) {
//     dojo.hiring = true;
//   } else if (dojo.students <= 0) {
//     dojo = "closed for now";
//   }
//   return dojo;
// }
// console.log(makeDojo("Chicago", 65));
// console.log(makeDojo("Berkeley", 0));

// output:
//    TypeError: Assignment to constant variable





ES6 ANSWERS:

/ Functions are always hoisted first
// vars are hoisted immediately after (below) the functions
// https://262.ecma-international.org/5.1/#sec-10.5

// #1 - GIVEN
console.log(hello);
let hello = "world";
// console.log(hello);
// let hello = "world";

// output:
//   ReferenceError: Cannot access 'hello' before initialization  <-- line 6

// #2 - GIVEN
let needle = "haystack";
test();
function test() {
  let needle = "magnet";
  console.log(needle);
}
// function test() {
//   let needle = "magnet";
//   console.log(needle);
// }
// let needle = "haystack";
// test();

// output:
//    magnet

// #3 - GIVEN
let brendan = "super cool";
function print() {
  brendan = "only okay";
  console.log(brendan);
}
print();
console.log(brendan);
// function print() {
//   brendan = "only okay";
//   console.log(brendan);
// }
// let brendan = "super cool";
// print();
// console.log(brendan);

// output:
//    only okay
//    only okay

// #4 - GIVEN
let food = "chicken";
console.log(food);
eat();
function eat() {
  food = "half-chicken";
  console.log(food);
  let food = "gone";
}
// function eat() {
//   food = "half-chicken";
//   console.log(food);
//   let food = "gone";
// }
// let food = "chicken";
// console.log(food);
// eat();

// output:
//    chicken
//    ReferenceError: Cannot access 'food' before initialization  <-- line 61

// #5 - GIVEN
mean();
console.log(food);
const mean = function () {
  food = "chicken";
  console.log(food);
  let food = "fish";
  console.log(food);
};
console.log(food);
// mean();
// console.log(food);
// const mean = function () {
//   food = "chicken";
//   console.log(food);
//   let food = "fish";
//   console.log(food);
// };
// console.log(food);

// output:
//    TypeError: mean is not a function  <-- line 74

// #6 - GIVEN
console.log(genre);
let genre = "disco";
rewind();
function rewind() {
  genre = "rock";
  console.log(genre);
  let genre = "r&b";
  console.log(genre);
}
console.log(genre);
// function rewind() {
//   genre = "rock";
//   console.log(genre);
//   let genre = "r&b";
//   console.log(genre);
// }
// console.log(genre);
// let genre = "disco";
// rewind();
// console.log(genre);

// output:
//   ReferenceError: Cannot access 'genre' before initialization  <-- line 97

// #7 - GIVEN
dojo = "san jose";
console.log(dojo);
learn();
function learn() {
  console.log(dojo);
  dojo = "seattle";
  console.log(dojo);
  let dojo = "burbank";
  console.log(dojo);
}
console.log(dojo);
// function learn() {
//   console.log(dojo);
//   dojo = "seattle";
//   console.log(dojo);
//   let dojo = "burbank";
//   console.log(dojo);
// }
// dojo = "san jose";    // Javascript allows this even though it is NOT defined as a var in the global scope
// console.log(dojo);
// learn();
// console.log(dojo);

// output:
//    error is from line 126 - not where you think!
//    ReferenceError: Cannot access 'dojo' before initialization

// #8 - GIVEN
console.log(makeDojo("Chicago", 65));
console.log(makeDojo("Berkeley", 0));
function makeDojo(name, students) {
  const dojo = {};
  dojo.name = name;
  dojo.students = students;
  if (dojo.students > 50) {
    dojo.hiring = true;
  } else if (dojo.students <= 0) {
    dojo = "closed for now";
  }
  return dojo;
}
// function makeDojo(name, students) {
//   const dojo = {};
//   dojo.name = name;
//   dojo.students = students;
//   if (dojo.students > 50) {
//     dojo.hiring = true;
//   } else if (dojo.students <= 0) {
//     dojo = "closed for now";
//   }
//   return dojo;
// }
// console.log(makeDojo("Chicago", 65));
// console.log(makeDojo("Berkeley", 0));

// output:
//    TypeError: Assignment to constant variable   <-- line 159















